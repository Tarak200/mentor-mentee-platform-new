<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Connection Request & Popup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .btn {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #4f46e5;
            color: white;
        }
        .btn-success {
            background: #10B981;
            color: white;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(31, 41, 55, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1100;
        }
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 480px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.15);
            position: relative;
            z-index: 1101;
        }
        .success-popup {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Connection Request & Popup Test</h1>
    
    <div class="test-section">
        <h2>Step 1: Test Popup Functionality</h2>
        <button class="btn btn-success" onclick="testShowPopup()">Test Success Popup</button>
        <div id="popupStatus" class="status" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Step 2: Test Connection Request API</h2>
        <p>First login:</p>
        <input type="email" id="email" placeholder="Email" value="alex.thompson@email.com" style="padding: 8px; margin: 5px; width: 200px;">
        <input type="password" id="password" placeholder="Password" value="password123" style="padding: 8px; margin: 5px; width: 200px;">
        <button class="btn btn-primary" onclick="testLogin()">Login</button>
        <div id="loginStatus" class="status" style="display: none;"></div>
        
        <div id="connectionTest" style="display: none;">
            <p>Now test connection request:</p>
            <button class="btn btn-primary" onclick="testConnectionRequest()">Send Connection Request</button>
            <div id="connectionStatus" class="status" style="display: none;"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Step 3: Instructions for Browser Testing</h2>
        <ol>
            <li>Clear your browser cache: Ctrl+Shift+Delete</li>
            <li>Close all browser tabs</li>
            <li>Open a new incognito/private window</li>
            <li>Go to <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
            <li>Login with: alex.thompson@email.com / password123</li>
            <li>Navigate to "Find Mentors" section</li>
            <li>Click "Connect Now" on any mentor</li>
            <li>Fill the form and submit</li>
            <li>Look for the green success popup!</li>
        </ol>
    </div>

    <!-- Success Popup Modal (same as in dashboard) -->
    <div id="successPopup" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeSuccessPopup()"></div>
        <div class="modal-content success-popup">
            <div class="success-icon">
                <i class="fas fa-check-circle" style="color: #10B981; font-size: 3rem;">âœ“</i>
            </div>
            <div class="success-content" style="text-align: center; padding: 20px;">
                <h3 style="color: #10B981; margin: 10px 0;">Success!</h3>
                <p id="successPopupMessage" style="margin: 15px 0; line-height: 1.5;"></p>
                <button onclick="closeSuccessPopup()" class="btn btn-primary" style="margin-top: 20px;">OK</button>
            </div>
        </div>
    </div>

    <script>
        let authToken = null;

        // Success popup functions (same as dashboard)
        function showSuccessPopup(message) {
            const popup = document.getElementById('successPopup');
            const messageEl = document.getElementById('successPopupMessage');
            
            if (popup && messageEl) {
                messageEl.innerHTML = message.replace(/\n/g, '<br>');
                popup.style.display = 'flex';
                
                // Auto close after 5 seconds
                setTimeout(() => {
                    closeSuccessPopup();
                }, 5000);
            }
        }

        function closeSuccessPopup() {
            const popup = document.getElementById('successPopup');
            if (popup) {
                popup.style.display = 'none';
            }
        }

        function testShowPopup() {
            showSuccessPopup('Connection request sent successfully! ðŸŽ‰\n\nThe mentor will review your request and respond soon.');
            document.getElementById('popupStatus').textContent = 'Popup should appear now!';
            document.getElementById('popupStatus').className = 'status success';
            document.getElementById('popupStatus').style.display = 'block';
        }

        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const statusEl = document.getElementById('loginStatus');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    authToken = result.data.token;
                    statusEl.textContent = 'Login successful! âœ“';
                    statusEl.className = 'status success';
                    document.getElementById('connectionTest').style.display = 'block';
                } else {
                    statusEl.textContent = 'Login failed: ' + result.message;
                    statusEl.className = 'status error';
                }
            } catch (error) {
                statusEl.textContent = 'Login error: ' + error.message;
                statusEl.className = 'status error';
            }
            
            statusEl.style.display = 'block';
        }

        async function testConnectionRequest() {
            if (!authToken) {
                alert('Please login first!');
                return;
            }
            
            const statusEl = document.getElementById('connectionStatus');
            
            try {
                const response = await fetch('/api/mentee/request', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        mentorId: 'mentor_2',
                        goals: 'Test connection request functionality',
                        message: 'Testing if the connection request works from the test page',
                        preferredSchedule: 'Any time'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.textContent = 'Connection request sent successfully! Request ID: ' + result.data.id;
                    statusEl.className = 'status success';
                    
                    // Show the popup!
                    showSuccessPopup('Connection request sent successfully! ðŸŽ‰\n\nThe mentor will review your request and respond soon.');
                } else {
                    statusEl.textContent = 'Connection request failed: ' + result.message;
                    statusEl.className = 'status error';
                }
            } catch (error) {
                statusEl.textContent = 'Connection request error: ' + error.message;
                statusEl.className = 'status error';
            }
            
            statusEl.style.display = 'block';
        }
    </script>
</body>
</html>
